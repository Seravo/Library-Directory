description "Elastic Search (Java) server"
author      "Seravo Oy (http://seravo.fi/)"

start on (net-device-up
          and local-filesystems
          and runlevel [2345])

stop on runlevel [016]

respawn

env ES_HOME=/var/www/libdir/elasticsearch
env ES_MIN_MEM=256m
env ES_MAX_MEM=2g
env DAEMON="${ES_HOME}/bin/elasticsearch"
env DATA_DIR="${ES_HOME}/data"
env CONFIG_DIR="${ES_HOME}/config"
env LOG_DIR="${ES_HOME}/logs"

console output

exec su libdir -c "$DAEMON -f -Des.path.conf=$CONFIG_DIR -Des.path.home=$ES_HOME -Des.path.logs=$LOG_DIR -Des.path.data=$DATA_DIR"

pre-start script
    # Date format same as (new Date()).toISOString() for consistency
    echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (sys) Starting" >> /var/log/libdir-server.log
end script

pre-stop script
    rm /var/run/elasticsearch.pid
    echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (sys) Stopping" >> /var/log/libdir-server.log
end script
