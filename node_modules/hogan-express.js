// credits: https://github.com/micahasmith/Nodestrap/blob/master/hogan-express.js

// console.log("lang " + lang);
// lang and gettext global, visible also here

var HoganExpressAdapter=(function(){
	var init=function(hogan) {
		var compile=function(source){
		
            // extra block for on-the-fly translations
    		nothing_left_to_translate = false;
		    pat = /_\("(.*)"\)/m; // search for strings of type ((Here is text))
		    while (nothing_left_to_translate == false) {
      		    res = pat.exec(source); // execute search, return first occurence
                if (!!res) { // if not null, translate that occurence
	        	    // console.log(JSON.stringify(res));
	        	    source = source.replace(pat, _(res[1]));
	        	    // console.log(source);
	        	    res = pat.exec(source); // ..and continue searching for the next
	        	} else { // if null, nothing more to translate left, stop looping
	        	    nothing_left_to_translate = true;
	        	}
	        }

		    
			return function(options) {
			  return hogan.compile(source).render(options);
			};
		}
		return {compile:compile};
	};
	return {init:init};
}());

if(typeof module!== 'undefined' && module.exports){
	module.exports=HoganExpressAdapter;
} else if (typeof exports!=='undefined') {
	exports.HoganExpressAdapter=HoganExpressAdapter;
}

